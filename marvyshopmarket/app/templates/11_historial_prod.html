{% extends 'base.html' %}

{% block title %}Marvy Shopmarket | Historial de productos {% endblock %}

    
{% block content %}
    {% if estado==1 %}
    <div class="mensaje" style="display: flex;">
        <p class="mensaje-content" style="color: var(--btn-claro-continuar);">{{mensaje}}<br><img src="{{ url_for('static', filename='images/comprobado.png') }}" alt="comprobado" width=30%></p>
        
    </div>        
    <script>
        // const mensajes = document.getElementsByClassName('mensaje');

        function redirigirDespuesDeTiempo() {
            setTimeout(function() {
                window.location.href = '/productos'; 
            }, 2000);   
        }

        redirigirDespuesDeTiempo();
    </script>
    {% elif estado==0 %}
    <div class="mensaje" style="display: flex;">
        <p class="mensaje-content" style="color: var(--btn-claro-cancelar);">{{mensaje}}<br><img src="{{ url_for('static', filename='images/error.png') }}" alt="comprobado" width=30%></p>
    </div>
                
    <script>
        // const mensajes2 = document.getElementsByClassName('mensaje');

        function redirigirDespuesDeTiempo() {
            setTimeout(function() {
                window.location.href = '/productos'; 
            }, 2000);   
        }

        redirigirDespuesDeTiempo();
    </script>

    {% else %}
    <div class="mensaje">
        <p class="mensaje-content">{{mensaje}}</p>
    </div>
    {% endif %}
<div class="logo" id="logo">
    <div><img src="{{ url_for('static', filename='images/logo_marvy.png') }}" class="imagen" alt="icono tienda"></div>
</div>
<div class="registro" id="registro-ventas">
    <div class="title">
        <h1>Inventario de productos</h1>
    </div>
    <div class="formulario">
        <form method="post" action="/productos" enctype="multipart/form-data" id="form-ventas">
            <div class="formulario">
                <!-- <form method="post" action="/nuevo_producto" enctype="multipart/form-data">
                    <div>
                        <div><label for="prod_Id">Identificación:</label></div>
                        <div><input type="number" name="prod_Id" class="input-style"></div>
                    </div>
                    <div>
                        <div><label for="prod_Nombre">Nombre Producto:</label></div>
                        <div><input type="text" name="prod_Nombre" class="input-style"></div>
                    </div>
                    <div>
                        <div><label for="prod_Precio"> Precio:</label></div>
                        <div><input type="number" name="prod_Precio" id="prod_Precio" class="input-style"></div>
                    </div>
                    <div>
                        <div><label for="prod_Ganancia">Porcentaje de ganancia: </label></div>
                        <div><input type="number" name="prod_Ganancia" id="prod_Ganancia" class="input-style"> %</div>
                    </div>
                    <div>
                        <div><label for="prod_Cantidad">Cantidad Producto:</label></div>
                        <div><input type="number" name="prod_Cantidad"></div>
                    </div>
                    <div>
                        <div><label for="prod_Img">Imagen del producto</label></div>
                        <div><input type="file" name="prod_Img" id="prod_Img"></div>
                    </div>
                    <div class="boton-confitmar">
                        <button type="submit" class="btn-submit">Confirmar</button>
                    </div>
                </form> -->
                <style>
                    /* Estilos para la tabla */
                    table {
                        width: 100%;
                        border-collapse: collapse;
                        border-spacing: 0;
                    }
                    
                    th, td {
                        padding: 12px 15px;
                        text-align: left;
                        border-bottom: 1px solid #ddd;
                    }
                    
                    th {
                        background-color: #f2f2f2;
                        font-weight: bold;
                        color: #333;
                    }
                    th,td,tr{
                        text-align: center;
                    }
                    /* Estilo para las filas impares */
                    tr:nth-child(odd) {
                        background-color: #f9f9f9;
                    }
                    
                    /* Estilo para las filas al pasar el mouse */
                    tr:hover {
                        background-color: #e9e9e9;
                    }
                    
                    /* Estilos para las celdas al pasar el mouse */
                    td:hover {
                        background-color: #dcdcdc;
                    }
                    
                    /* Estilo para la primera columna */
                    td:first-child, th:first-child {
                        border-left: 0;
                    }
                    
                    /* Estilo para la última columna */
                    td:last-child, th:last-child {
                        border-right: 0;
                    }
                </style>
                  
            <table style="font-size: 0.5rem;">
                <tbody>
                    <tr>
                        <td>
                            <label>Nombre: </label>
                            <div><input placeholder="nombre del producto" name="prod_Nombre" id="nombre-producto-venta" ></div>
                        </td>
                        <td>
                            <label>Precio: </label>
                            <div>$ <input type="number" placeholder="precio" name="prod_Precio" id="prod_Precio" ></div>
                        </td>
                        <td>
                            <label>Cantidad: </label>
                            <div><input type="number" placeholder="cantidad" name="prod_Cantidad" id="prod_Cantidad"></div>
                        </td>
                        <td>
                            <label>Ganancia: </label>
                            <div><input type="number" placeholder="ganancia" name="prod_Ganancia" id="prod_Ganancia"> %</div>
                        </td>
                        <td>
                            <div>
                                <div><label for="prod_Img">Imagen del producto</label></div>
                                <div><input type="file" name="prod_Img" id="prod_Img"></div>
                            </div>
                        </td>
                        <td>
                            <div class="botones-secundarios">
                                <button type="submit" class="btn-submit" style="background: none; border: none; cursor: pointer;"><i class="fa-solid fa-floppy-disk" style="color: green; font-size: 1.3rem;"></i></button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <!-- <div class="botones-secundario">
                <button type="submit" class="btn-submit">Confirmar</button>
            </div> -->
        </form>
    </div>
    <!-- <form action="/pagina-principal" method="GET">
        <button style="margin: 2%; width: 50%;">Atrás</button>
    </form>
    <div class="title"><h1>Inventario de productos</h1></div>
    <form action="/pagina-principal" method="GET">
        <button style="margin: 2%; width: 50%;">Descargar</button>
    </form>
    <div style="grid-row: 2; grid-column: 1/-1;" class="formulario">
        <form method="post" action="/registro-ventas" enctype="multipart/form-data" id="form-ventas">
            <table >
                <tbody>
                    <tr>
                        <td>
                            <label>Id factura: </label>
                            <div><input placeholder="#" id="id-venta" name="id-registro-venta"></div>
                        </td>
                        <td>
                            <label>Id: </label>
                            <div><input placeholder="Id producto" id="id-producto-venta" class="id-producto-venta"></div>
                        </td>
                        <td>
                            <label>Nombre: </label>
                            <div><input placeholder="Nombre del producto" id="nombre-producto-venta" name="nombre-producto-venta"></div>
                        </td>
                        <td>
                            <label>Precio: </label>
                            <div>$ <input type="number" placeholder="Precio del producto" id="precio-producto-venta" name="precio-producto-venta"></div>
                        </td>
                        <td>
                            <label>Cantidad: </label>
                            <div><input type="number" placeholder="Cantidad del producto" name="cantidad-producto-vendido" id="cantidad-producto-vendido"></div>
                        </td>
                        <td>
                            <div class="botones-secundarios">
                                <button type="submit" class="btn-submit" style="background: none; border: none; cursor: pointer;"><i class="fa-solid fa-floppy-disk" style="color: green; font-size: 1.3rem;"></i></button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table> -->
            <!-- <div class="botones-secundario">
                <button type="submit" class="btn-submit">Confirmar</button>
            </div> -->
        <!-- </form>
        <div id="container-producto">
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Precio bruto</th>
                        <th>Cantidad</th>
                        <th>Total bruto</th>
                        <th>Ganancia</th>
                        <th>Precio Unitario</th>
                        <th>Total</th>
                        <th>Imagen</th>
                    </tr>
    
                </thead>
                <tbody>
                        {% for producto,imagen_codificada in resultado %}
                        <tr>
                            <td>{{ producto.prod_Nombre }}</td>
                            <td>$ {{ producto.prod_Precio}}</td>
                            <td>{{ producto.prod_Cantidad}}</td>
                            <td>$ {{producto.prod_Total}}</td>
                            <td>{{ producto.prod_Ganancia}}%</td>
                            <td>$ {{producto.prod_TotalPrecio}}</td>
                            <td>$ {{producto.prod_TotalGana}}</td>
                            <td width="250"><img src="data:image/png;base64,{{ imagen_codificada}}" class="imagen-producto" alt="{{ producto.prod_Nombre }}" id="imagen_producto"></td>
                        </tr>
                        {% endfor %}
                </tbody>
                
            </table>  
        </div>
    </div> -->
    <div id="container-producto">
    
        <table>
            <thead>
                <tr>
                    <th>Código</th>
                    <th  width="180">Producto</th>
                    <th>Precio bruto</th>
                    <th>Ganancia</th>
                    <th>Precio Unitario</th>
                    <th>Cantidad</th>
                    <th>Total bruto</th>
                    <th>Total</th>
                    <th>Gana</th>
                    <!-- <th  width="80">Imagen</th> -->
                    <th  width="20">Editar</th></a>
                </tr>

            </thead>
            <tbody>
                    <!-- HTML y Jinja -->
                    {% for index in range(resultado | length) %}
                        {% set producto, imagen_codificada = resultado[index] %}
                        {% set ganancia = ganancias[index] %}
                        {% set producto_color = producto.producto_color %}
                        
                        <tr id="registro_{{ producto.Id }}">
                            <td>{{ producto.Id }}</td>
                            <td>{{ producto.prod_Nombre }}</td>
                            <td>$ {{ producto.prod_Precio }}</td>
                            <td>{{ producto.prod_Ganancia }}%</td>
                            <td>$ {{ producto.prod_TotalPrecio }}</td>
                            {% if producto.prod_Cantidad > 0 and producto.prod_Cantidad <=5 %}
                                <td style="background-color: rgb(255, 122, 0);">{{ producto.prod_Cantidad }}</td>
                            {% endif %}
                            {% if producto.prod_Cantidad > 5 and producto.prod_Cantidad < 10 %}
                            <td style="background-color: rgb(255, 255, 55);">{{ producto.prod_Cantidad }}</td>
                            {% endif %}
                            {% if producto.prod_Cantidad >= 10 %}
                                <td style="background-color: rgb(123, 241, 12);">{{ producto.prod_Cantidad }}</td>
                            {% endif %}
                            {% if producto.prod_Cantidad == 0 %}
                                <td style="background-color: rgb(241, 58, 12);">{{ producto.prod_Cantidad }}</td> 
                            {% endif %}
                            <td>$ {{ producto.prod_Total }}</td>
                            <td>$ {{ producto.prod_TotalGana }}</td>
                            <td>$ {{ ganancia }}</td>
                            <!-- <td width="250"><img src="data:image/png;base64,{{ imagen_codificada }}" class="imagen-producto" alt="{{ producto.prod_Nombre }}" id="imagen_producto"></td> -->
                            <td>
                                <a href="/editar-producto/{{ producto.Id }}" style="color: var(--claro-principal);" class="editar-producto"><i class="fa-solid fa-pen-to-square"></i></a>
                            </td>
                        </tr>
                    {% endfor %}
            </tbody>
            
        </table>  
    </div>  
    <form action="/home" method="GET">
        <button>Atrás</button>
    </form>    
{% endblock %}